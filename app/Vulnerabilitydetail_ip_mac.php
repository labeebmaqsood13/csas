<?php

namespace App;

use Illuminate\Database\Eloquent\Model;

use App\Vulnerabilitydetail;

class Vulnerabilitydetail_ip_mac extends Model
{
    public $table = 'vulnerabilities_detail_ip_mac';
    public $fillable = ['vulnerability_detail_id','ip','mac'];

    public function store($array_of_vulnerability_ip_mac){

    	foreach($array_of_vulnerability_ip_mac as $v_name => $each){

    		$count = sizeof($each);

			$Vulnerabilitydetail = new \App\Vulnerabilitydetail();

			// $flights = $Vulnerabilitydetail->all();
			$vulnerability = $Vulnerabilitydetail->where('vulnerability', $v_name)->get();
		    $vulnerability = $vulnerability['0']['id'];



			// return $vulnerability = $this->Vulnerabilitydetail()->where('vulnerability', $v_name)->get();
			// return $vulnerability = $this->Vulnerabilitydetail()->find('id')->where('vulnerability', $v_name);

			// return \App\Vulnerabilitydetail::where('vulnerability', 'Nessus Scan Information')->get('name');
			// // return $vulnerability = \App\Vulnerabilitydetail::find('id')->where('vulnerability', $v_name);

    		// for($i=0; $i<$count; $i++){

			$i=0;
			while($i<$count-1){

		    	Vulnerabilitydetail_ip_mac::create([
		    		'vulnerability_detail_id' => $vulnerability,	
		    		'ip'  					  => $each[$i],
		    		'mac' 					  => $each[$i+1],
	    		]);

			    $i = $i + 2;
	    	}	
	    
	    }	

    }

    public function read(){

		$vulnerabilities_detail_ip_mac = $this->all();
		return $vulnerabilities_detail_ip_mac;    	
		
		// $vulnerabilities_detail = Vulnerabilitydetail_ip_mac::with('Vulnerabilitydetail')->find($id); 
		// echo $vulnerabilities_detail->name;
		// echo $vulnerabilities_detail->description;
		// echo $vulnerabilities_detail->solution;

		// $vulnerabilities_detail_ip_mac = Vulnerabilitydetail_ip_mac::with('Vulnerabilitydetail')->find($id);

    
    }

    public function vulnerabilitydetail(){

    // One vulnerability can be in one or many ip's/mac

    	// An Ip belongs to one a vulnerability. 	
    	return $this->belongsTo('App\vulnerabilitydetail');	

    }

}








